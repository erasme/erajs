<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Era Sample Browser</title>
		<script src='../era/js/era-debug.js'></script>
<script>

//
// The Sample browser
//

Ui.Html.extend('SampleBrowser.CodeHighlighter', {
	request: undefined,

	constructor: function(config) {
	},

	setSrc: function(src) {
		this.request = new Core.HttpRequest({ url: 'highlight.php?file='+encodeURIComponent(src) });
		this.connect(this.request, 'done', this.onRequestDone);
		this.request.send();
	},

	onRequestDone: function() {
		var text = this.request.getResponseText();
		this.request = undefined;
		this.setHtml(text);
	}
});

Ui.App.extend('SampleBrowser.App', {
	samples: undefined,
	request: undefined,
	iframe: undefined,
	current: undefined,
	transbox: undefined,
	highlighter: undefined,
	scroll: undefined,

	constructor: function(config) {
		var hbox = new Ui.HBox();
		this.setContent(hbox);

		var vbox = new Ui.VBox();
		hbox.append(vbox);

		var toolbar = new Ui.ToolBar();
		vbox.append(toolbar);

		toolbar.append(new Ui.Label({ text: 'Samples', color: 'white', fontWeight: 'bold', margin: 5 }));

		var button = new Ui.Button({ text: 'l' });
		toolbar.append(button);
		button.hide();

		var scroll = new Ui.ScrollingArea({ scrollHorizontal: false });
		vbox.append(scroll, true);

		this.samples = new Ui.VBox();
		scroll.setContent(this.samples);

		this.request = new Core.HttpRequest({ url: 'list.php' });
		this.connect(this.request, 'done', this.onListDone);
		this.request.send();

		hbox.append(new Ui.Rectangle({ width: 2, height: 2, fill: new Ui.LinearGradient({ orientation: 'horizontal', stops: [ { offset: 0, color: new Ui.Color({ r: 0.4, g: 0.4, b: 0.4 }) }, { offset: 0.9, color: new Ui.Color({ r: 0.8, g: 0.8, b: 0.9 }) }, { offset: 1, color: new Ui.Color({ r: 0.4, g: 0.4, b: 0.4 }) } ] }) }));

		vbox = new Ui.VBox();
		hbox.append(vbox, true);

		toolbar = new Ui.ToolBar();
		vbox.append(toolbar);

		toolbar.append(new Ui.Label({ text: 'Content', color: 'white', fontWeight: 'bold', margin: 5 }));

		toolbar.append(new Ui.Spacer(), true);

		button = new Ui.Button({ text: 'demo' });
		toolbar.append(button);
		this.connect(button, 'press', this.onDemoPress);

		button = new Ui.Button({ text: 'source' });
		toolbar.append(button);
		this.connect(button, 'press', this.onSourcePress);

		this.transbox = new Ui.TransitionBox();
		vbox.append(this.transbox, true);

		this.iframe = new Ui.IFrame();
		this.transbox.append(this.iframe);

		this.scroll = new Ui.ScrollingArea();
		this.transbox.append(this.scroll);

		this.highlighter = new SampleBrowser.CodeHighlighter({ margin: 10 });
		this.scroll.setContent(this.highlighter);
	},

	onListDone: function() {
		var response = this.request.getResponseJSON();
		for(var i = 0; i < response.samples.length; i++) {
			var sample = new SampleBrowser.SampleItem({ sample: response.samples[i] });
			this.connect(sample, 'select', this.onSampleSelect);
			this.samples.append(sample);
		}
	},

	onDemoPress: function() {
		this.transbox.setCurrent(this.iframe);
	},

	onSourcePress: function() {
		this.transbox.setCurrent(this.scroll);
	},

	onSampleSelect: function(sampleItem) {
		if(this.current != undefined)
			this.current.unselect();
		this.current = sampleItem;
		this.iframe.setSrc(sampleItem.getSample());
		this.highlighter.setSrc(sampleItem.getSample()+'/index.html');
		this.onDemoPress();
	}
});

Ui.Selectable.extend('SampleBrowser.SampleItem', {
	sample: undefined,
	background: undefined,

	constructor: function(config) {
		this.sample = config.sample;
		this.background = new Ui.Rectangle({ fill: new Ui.Color({ r: 0.9, g: 0.9, b: 0.9 }) });
		this.background.hide();
		this.append(this.background);

		var vbox = new Ui.VBox();
		this.append(vbox);

		vbox.append(new Ui.Label({ text: this.sample, horizontalAlign: 'left', margin: 5, marginTop: 10, marginBottom: 10 }));
		vbox.append(new Ui.Rectangle({ fill: new Ui.Color({ r: 0.6, g: 0.6, b: 0.6 }), height: 1 }));

		this.connect(this, 'select', this.onSampleItemSelect);
		this.connect(this, 'unselect', this.onSampleItemUnSelect);
	},

	onSampleItemSelect: function() {
		this.background.show();
	},
	
	onSampleItemUnSelect: function() {
		this.background.hide();
	},

	getSample: function() {
		return this.sample;
	}
});

new SampleBrowser.App();

</script>
  </head>
</html>
